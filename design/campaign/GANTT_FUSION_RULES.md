## 甘特图融合规则（Gantt Fusion Rules）

目标：提供简单、一致、可实现的“数量融合+主题继承”机制，用于把多个相邻节点合并为一场战斗，同时保持叙事与玩法不跳戏。

### 一、核心规则（最小可行集）
- 主题继承：融合战的主题等于“前一个节点”的主题（theme ∈ {LAB, FINALS, ROLL_CALL, …}）。
- 敌人数融合：总敌人数 = Σ 各节点的 `enemy_count`。
- Boss优先：若任一节点包含 Boss（`has_boss=true`），融合战以该 Boss 为主；其余按剩余数量用小怪填充。
- 同屏上限与波次：同屏最多 5 个敌人；超出部分进入第二波。当第一波剩余 ≤2 时，第二波入场。
- 难度缩放（可选）：每个“额外敌人”（超过单节点基准）可带来一次小幅缩放（如全体 +10% HP 或替换为 1 个精英）。
- 奖励倍率：结算奖励 × (1 + 0.2 × (参与节点数 - 1))。UI 上直观显示倍率。

事件与融合
- 事件（Event Overlay）仅为叠加提示与微互动，不参与融合与敌人数计算；也不改变主题。
- 事件来源采用“全局随机 + 主题偏置”的权重模型（ANY≈70%｜THEME≈20%｜LOCAL≈10%），Boss/关键战降权或静默。
- 事件的生成、寿命与数据口径见 `GANTT_TASKS_EVENTS.md`。

### 二、交互微卡（按主题提供，不影响主卡组）
- 每回合开始生成 1–2 张“主题微卡”，Ethereal + Exhaust，费用 0–1，服务当前主题（示例）：
  - LAB：安全提醒（+5 自信）、拔电源（目标虚弱2/机器人失控-1）、灭火毯（全体【规整】+1/本回合）
  - FINALS：批注修订（目标下次意图 -8）、归档（右移1；你+3自信）、端点加分（端点单位承受一次额外 PD）
  - ROLL_CALL：点名聚焦（定焦到目标；结算 PD 一次）、散场（反转队列/视图序）
- 融合仅影响“数量与波次”，不改变微卡池；微卡池随主题继承。

### 三、数据口径（Campaign 路由层）
```yaml
node:
  id: campus_lab_02
  theme: LAB        # 主题域
  enemy_count: 2    # 该节点的敌人数（无Boss时全为小怪）
  has_boss: false   # 该节点是否包含Boss

fusion_input:
  - { theme: LAB, enemy_count: 2, has_boss: false }
  - { theme: LAB, enemy_count: 3, has_boss: true }

fusion_result:
  theme: LAB                         # 继承第一个节点
  total_enemies: 5                   # 数量相加
  boss: true                         # 任意节点含Boss
  waves:
    first_wave: 5                    # 同屏上限 5
    second_wave: 0                   # 多余入第二波（若 >5）
  reward_multiplier: 1.2             # 1 + 0.2 × (2-1)
```

### 四、UI 与可读性
- 甘特条融合时仅显示：总敌人数、是否含 Boss、奖励倍率。
- 不跨主题换皮：主题由前节点确定；若确需跨域，使用“重采样皮肤”而非直切主题。

### 五、实现提示（非强制）
- 路由层先做融合（fold），战斗装配层根据 `fusion_result` 拉取对应主题的敌人表与微卡池。
- 波次管理简化：按剩余数量与阈值 2 触发第二波入场。


