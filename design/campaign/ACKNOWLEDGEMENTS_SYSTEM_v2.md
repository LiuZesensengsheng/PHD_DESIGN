# "论文致谢"系统设计文档 v2.0（基于当前设计内核）

## 1. 设计哲学：游戏的情感终点

"论文致谢"系统是我们游戏对传统"成就系统"的彻底颠覆。它不是一个用于炫耀或解锁内容的冰冷列表，而是这款游戏的**情感核心**与**最终沉淀**。

它的存在，是为了记录玩家在博士生涯（游戏流程）中所经历的每一个或光辉、或荒诞、或温暖、或痛苦的瞬间，并最终将这些瞬间汇聚成一篇独一无二的、由玩家亲手"书写"的博士论文致谢。

这不只是一个系统，这是我们献给每一位拥有相似经历的玩家的，一封最深情的情书。

---

## 2. 核心体验与UI设计

### 2.1 触发时机
- **实时记录**：玩家达成特定目标时，系统在后台静默记录，**不打断游戏流程**（不弹成就提示）。
- **最终呈现**：当玩家通关游戏（完成所有任务线并达成毕业），在制作人员名单结束后，最后的画面将定格在这张由玩家自己"写就"的、独一无二的致谢页面上。

### 2.2 UI呈现
- **稿纸界面**：模拟的、极简的论文稿纸界面（可选Word/LaTeX风格）。
- **逐字打字效果**：致谢文本以打字机效果逐字呈现，营造"书写"的仪式感。
- **分段呈现**：致谢按类别分段（导师、组会、任务线、战斗、理想等），每段之间有适当的停顿。

---

## 3. 致谢条目分类（基于当前实现）

### 3.1 理想选择类（Ideals）

**触发条件**：玩家在游戏开始时选择了特定的理想组合。

- **纯色理想**（只选一种颜色，如全白/全蓝/全黑/全红/全绿）：
  - **白色（秩序）**："感谢所有为秩序与确定性而奋斗的先驱者。他们的工作为本研究提供了清晰的范式与标准。"
  - **蓝色（理论）**："感谢所有为逻辑的严谨与优美而奋斗的先驱者，他们的工作是本研究的基石。"
  - **黑色（野心）**："感谢那些教会我'不择手段'的人。他们的存在，让我明白了什么是真正的'学术生存'。"
  - **红色（影响）**："感谢所有敢于打破常规、用行动改变世界的人。他们的勇气，是本研究的灵感源泉。"
  - **绿色（厚积）**："感谢时间，感谢耐心，感谢那些在沉默中积累、在等待中成长的日子。"

- **双色组合**（选2种颜色）：
  - **白+蓝（秩序+理论）**："感谢逻辑的严谨与秩序的优雅。它们共同构成了本研究的哲学基础。"
  - **黑+红（野心+影响）**："感谢那些教会我'不择手段'与'不计后果'的人。没有他们，就没有今天的我。"
  - （其他组合可扩展）

- **三色及以上**（选3-5种颜色）：
  - **全选（五色俱全）**："感谢这个世界的复杂性。感谢秩序与混乱、理想与现实的交织，它们共同塑造了本研究的独特视角。"

### 3.2 组会经历类（Meeting）

**触发条件**：基于 `meeting_event_used`, `meeting_mentor_used`, `meeting_free_upgrade_left` 等持久化数据。

- **首次组会**（第0回合组会）：
  - "感谢我的导师，X教授。他的严格要求与悉心指导，为本研究指明了方向。"
  
- **导师建议使用**（`meeting_mentor_used = True`）：
  - **使用免费升级**："感谢导师在关键时刻的提点，让我的研究思路得以升华。"
  - **使用免费删除**："感谢导师的果断建议，让我及时舍弃了那些看似重要、实则无用的'学术垃圾'。"

- **组会事件触发**（`meeting_event_used = True`）：
  - "感谢组会中的每一次交流。无论是导师的指导，还是同门的建议，都为本研究提供了宝贵的灵感。"

- **组会卡牌购买**（通过组会购买过卡牌）：
  - "感谢组会中'抄一点师兄的想法'的机会。那些看似随意的讨论，往往蕴含着最深刻的洞察。"

- **组会特性购买**（通过组会购买过特性）：
  - "感谢组会中分享的'实验室小秘籍'。那些看似不起眼的技巧，往往能解决最关键的问题。"

- **多次组会**（触发过3次及以上组会）：
  - "感谢每周的组会。它们不仅是学术交流的平台，更是我博士生涯中最稳定的'锚点'。"

### 3.3 任务线类（Task Lines）

**触发条件**：基于 `_blocks`, `track_index`, `_thesis_track_meta` 等数据。

- **单任务线通关**（只有1条任务线）：
  - "感谢我的专注。在无数个选择面前，我选择了'一条路走到黑'。"
  
- **多任务线并行**（同时有3-4条任务线）：
  - "感谢那些同时推进的多个项目。它们教会了我什么是'多线程工作'，什么是'时间管理'。"
  
- **任务线腐化**（有任务线的腐化度 > 某个阈值）：
  - "感谢那些被拖延、被遗忘、最终'腐化'的任务。它们让我明白了什么是'现实的残酷'。"

- **任务线完成度极高**（某条任务线完成度接近总量）：
  - "感谢那些几乎完成、却最终未能完成的项目。它们让我明白了什么是'功亏一篑'。"

### 3.4 战斗经历类（Combat）

**触发条件**：基于战斗记录（如果未来有持久化）。

- **首次战斗胜利**：
  - "感谢我的第一个对手。他们的质疑，是磨砺我论点的最佳磨刀石。"
  
- **压力管理**（战斗中以低压力获胜）：
  - "感谢那些教会我'在压力中保持冷静'的经历。"
  
- **自信防御**（战斗中大量使用自信防御）：
  - "感谢那些让我学会'相信自己'的时刻。自信，是最好的防御。"

### 3.5 卡牌构筑类（Deck Building）

**触发条件**：基于 `deck_card_ids`, `upgraded_card_ids` 等数据。

- **卡组精简**（最终卡组 ≤ 10张）：
  - "感谢我的'极简主义'。在无数选择面前，我选择了'少即是多'。"
  
- **卡组庞大**（最终卡组 ≥ 30张）：
  - "感谢我的'收集癖'。每一张卡牌，都记录着一段独特的学术经历。"
  
- **大量升级**（升级卡牌数量 ≥ 5张）：
  - "感谢那些被我反复打磨、不断升级的'核心思路'。它们见证了本研究的成长。"

- **从未升级**（升级卡牌数量 = 0）：
  - "感谢我的'原教旨主义'。我相信，最原始的想法，往往最接近真理。"

### 3.6 灵感与资源类（Inspiration）

**触发条件**：基于 `inspiration` 的累计使用/获得。

- **灵感积累**（累计获得灵感 ≥ 100）：
  - "感谢那些'灵感迸发'的瞬间。它们像火花一样，点亮了本研究的每一个角落。"
  
- **灵感稀缺**（大部分时间灵感 < 50）：
  - "感谢那些'灵感枯竭'的日子。它们让我明白了什么是'学术的常态'。"

### 3.7 回合与时间类（Turns）

**触发条件**：基于 `current_turn`。

- **快速通关**（通关回合数 ≤ 20）：
  - "感谢我的效率。在最短的时间内，我完成了最不可能完成的任务。"
  
- **漫长旅程**（通关回合数 ≥ 40）：
  - "感谢时间。在这段漫长的旅程中，我学会了什么是'坚持'，什么是'耐心'。"

### 3.8 特殊成就类（Special）

- **首次通关**：
  - "**最后，我要由衷地感谢我自己。感谢我在无数个想要放弃的瞬间，选择了继续。**"
  
- **完美通关**（所有任务线完成度 = 100%，无腐化）：
  - "**谨以此文献给我自己。感谢我的完美主义，感谢我的坚持，感谢我的不妥协。**"
  
- **摆烂通关**（所有任务线腐化度极高，但依然通关）：
  - "**最后，我要由衷地感谢我的导师。感谢他不仅为本研究指明了方向，更是在最关键的时刻，亲自为本研究扫清了障碍。没有他，就没有这本论文。字面意义上。**"

---

## 4. 技术实现方案

### 4.1 数据追踪

在 `CampaignState.persistent` 中新增字段：
```python
persistent['acknowledgements'] = {
    'unlocked': List[str],  # 已解锁的致谢条目ID列表
    'metadata': {
        'first_meeting_turn': int,  # 首次组会回合
        'meeting_count': int,  # 组会触发次数
        'mentor_upgrade_used': bool,  # 是否使用过导师免费升级
        'mentor_delete_used': bool,  # 是否使用过导师免费删除
        'event_triggered': bool,  # 是否触发过组会事件
        'cards_bought_in_meeting': int,  # 组会中购买的卡牌数
        'traits_bought_in_meeting': int,  # 组会中购买的特性数
        'max_task_lines': int,  # 同时存在的最大任务线数
        'total_upgraded_cards': int,  # 升级过的卡牌总数
        'final_deck_size': int,  # 最终卡组大小
        'total_inspiration_earned': int,  # 累计获得的灵感
        'final_turn': int,  # 通关回合数
        # ... 其他可追踪的数据
    }
}
```

### 4.2 触发检测

在关键节点检测并解锁致谢条目：
- **组会相关**：在 `MeetingService` 的各个方法中检测并更新 `acknowledgements`。
- **任务线相关**：在 `TrackBlockService` 中检测任务线变化。
- **卡牌相关**：在卡牌购买/升级/删除时更新。
- **通关时**：在游戏结束时统一检测所有条件，生成最终致谢文本。

### 4.3 致谢文本生成

创建一个 `AcknowledgementsService`：
- **职责**：根据 `acknowledgements` 数据，生成最终的致谢文本。
- **逻辑**：
  1. 按优先级排序已解锁的致谢条目。
  2. 按类别分组（理想、组会、任务线等）。
  3. 生成结构化的致谢文本（开头、正文、结尾）。
  4. 处理特殊情况（如"完美通关"会覆盖某些常规致谢）。

### 4.4 UI呈现

创建一个 `AcknowledgementsState`：
- **职责**：在游戏通关后，展示致谢页面。
- **实现**：
  - 使用打字机效果逐字显示。
  - 支持暂停/继续。
  - 最终可以导出为文本文件或截图。

---

## 5. 与当前设计的融合

### 5.1 基于已实现的系统
- **组会系统**：`MeetingService` 已实现，可以直接在其中追踪致谢数据。
- **任务线系统**：`TrackBlockService` 已实现，可以追踪任务线状态。
- **理想系统**：`IdealsSelectionModal` 已实现，可以在选择时记录。
- **持久化**：`CampaignState.persistent` 已存在，可以直接扩展。

### 5.2 五色理想的哲学内核
- 致谢文本要体现五色理想的哲学内核（秩序、理论、野心、影响、厚积）。
- 不同理想组合会产生不同的致谢风格（严肃、幽默、黑色幽默等）。

### 5.3 情感与机制融合
- 致谢不是"成就列表"，而是"人生回顾"。
- 每一条致谢都对应玩家在游戏中的真实经历。
- 最终呈现要有仪式感，让玩家感受到"这是我自己的故事"。

---

## 6. 未来扩展

本系统具有极强的扩展性：
- 任何新增的游戏系统（如"羁绊"、"社交"等）都可以转化为致谢条目。
- 任何特殊的游戏事件（如"学术蝗虫"、"完美主义"等）都可以记录。
- 致谢文本可以支持多语言、多风格（严肃/幽默/黑色幽默）。

---

## 7. 实现优先级

### Phase 1（MVP）
1. 基础数据追踪（组会、任务线、卡牌、理想选择）。
2. 核心致谢条目（首次通关、理想选择、组会经历）。
3. 简单的文本生成与UI呈现。

### Phase 2（扩展）
1. 更多致谢条目（战斗、资源、特殊成就）。
2. 致谢文本的个性化（根据玩家选择调整语气）。
3. 导出功能（文本/截图）。

### Phase 3（完善）
1. 多语言支持。
2. 致谢文本的AI生成（可选）。
3. 致谢分享功能（可选）。

