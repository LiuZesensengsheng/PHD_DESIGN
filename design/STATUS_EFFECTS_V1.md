## 状态与结算规范 v1

本文件定义“破防( Vulnerable ) / 虚弱( Weak ) / 规整( Regulated ) / 严谨度( Rigor )”的语义、叠加、持续与结算顺序，作为实现与数值调参的统一口径。

### 共通规则
- **整数结算**: 全部数值以整数结算；乘算后统一向下取整（floor），至少为0。
- **结算顺序（伤害）**:
  1) 取基础伤害（卡牌/效果给定值）
  2) 攻击者减益（如“虚弱”）
  3) 防御者增伤（如“破防”）
  4) 其他加成/减免（范式/遗物/被动等）
  5) 造成伤害（进入最终结算）
  6) 最终结算附加：追加“规整”的纯伤（不参与任何乘算）
- **结算顺序（自信/回复）**:
  1) 取基础值（卡牌/范式）
  2) 加法修正（如“严谨度”对自信获得的加值）
  3) 乘法修正（若有）
  4) 向下取整

---

### 破防 Vulnerable
- **效果**: 受到的伤害 +50%。实现为乘以 1.5。
- **乘算与取整**: 乘算后向下取整（例如 7×1.5=10.5→10）。
- **叠加/持续**: 使用“持续回合数”机制（CSV 中的 duration 数值）。每当目标的回合结束，持续回合数 -1；降至0移除。
- **备注**: 仅影响“伤害”类结算，不影响“规整”追加的纯伤、自信变动等。

### 虚弱 Weak
- **效果**: 造成的伤害 -33%。实现为乘以 0.67（即 2/3）。
- **乘算与取整**: 乘算后向下取整（例如 10×0.67=6.7→6）。
- **叠加/持续**: 使用“持续回合数”机制；在施加时，持续回合数相加；在施加方的回合结束时 -1，降至0移除。
- **备注**: 仅作用于“造成伤害”的步骤，不影响“规整”的额外纯伤、自信等。

### 规整 Regulated
- **效果（v1）**: 本回合内，每次受到伤害时，**额外**承受 +X 点纯伤（不参与任何乘算，不受破防/虚弱/易伤等影响）。
- **来源**: “本回合规整 +X”类效果；常见取值 X∈{1,2,3}。
- **叠加/持续**: 本回合有效，回合结束清零；同回合内多次施加按数值叠加（例：先+1再+2，则本回合 X=3）。
- **结算位置**: 在“最终结算阶段”追加，即所有增减伤/格挡等处理完后，再直接追加纯伤 X。
- **扩展（可选）**: 若未来启用跨回合层（L）与当回合计数（k）的高级版，请以 v2 规约另行声明；本文件为 v1 简化口径。

### 严谨度 Rigor
- **效果**:
  - 你“从卡牌造成的伤害” +R（逐段生效）。
  - 你“从卡牌或范式获得的自信” +R。
- **叠加/上限**: 可叠加；建议执行实现侧的软/硬上限（参考：每单位每战至多 +3 层）。
- **作用范围**:
  - 伤害：仅对“来自卡牌/卡面标注的伤害效果”生效；不影响“规整”的纯伤追加。
  - 自信：对“卡牌直接授予的自信”与“范式在触发窗口授予的自信”均生效（如“回合开始：+N 自信”）。
- **结算与取整**: 加法在乘法前；无乘法时直接相加，保持整数。

---

### 示例
- 例1：攻击者有“虚弱”，被攻击者有“破防”，且目标本回合“规整 +2”。基础伤害 10。
  - 虚弱：10×0.67→6
  - 破防：6×1.5→9
  - 最终结算：先造成 9，再追加规整纯伤 +2，合计 11。
- 例2：你有严谨度 R=2，打出一张“造成 5×3 次”的卡。
  - 每段变为：(5+2)=7，共 7×3=21；若目标有规整 +1，则每段结束再追加 +1 纯伤，最终 7×3 + 1×3 = 24。
- 例3：你在回合开始拥有范式“获得 +2 自信”，且你有严谨度 R=1。
  - 本回合开始时，获得自信 = 2+1 = 3。

---

### 配置建议（占位）
- 破防: 持续 2–3 回合为常见值。
- 虚弱: 持续 2–3 回合为常见值。
- 规整: 常用“本回合 +1”；升级或稀有效果给 +2/+3；严控跨回合来源。
- 严谨度: 每单位每战上限 3（可在实现层护栏）。

---

### 术语对照与标识
- Vulnerable=破防, Weak=虚弱, Regulated=规整, Rigor=严谨度。
- 数据层建议使用常量 ID：STATUS_VULNERABLE, STATUS_WEAK, STATUS_REGULATED, STATUS_RIGOR。

> 本规范对应 CSV/文档现有描述：破防(+50%)、虚弱(-33%)、规整(每次受伤+X纯伤)、严谨度(卡牌伤害+R/自信+R)。后续若需调整取整或结算顺序，请在本文件中更新。


