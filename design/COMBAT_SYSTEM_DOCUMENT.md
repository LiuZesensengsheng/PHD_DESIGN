# 战斗系统完整说明文档

> 本文属于“权威三件套”之一：战斗系统。
> 总览入口：`docs/design/GAME_DESIGN_OVERVIEW.md`；战役（甘特）系统：`docs/design/GANTT_TRIS_MODEL_GDD.md`。

## 概述

《绝不延毕》是一款以博士论文答辩为主题的卡牌战斗游戏。本文档详细说明了战斗系统的数值设计、流程机制和核心规则，供主策划团队参考。

## 1. 核心数值系统

### 1.1 基础数值

#### 能量 (Energy)
- **作用**：支付卡牌费用的主要资源
- **初始值**：每回合开始时补充至最大值3点
- **最大值上限**：固定3点
- **补充规则**：每回合开始自动补充至3/3

#### 自信 (Confidence)
- **作用**：回合内的临时防御值
- **特性**：每回合结束时清零
- **获取方式**：
  - 打出防御类卡牌获得
  - 某些特质/遗物被动获得
  - 事件奖励获得

#### 压力值 (Health/Stress)
- **作用**：玩家的核心生命值
- **上限**：由角色的抗压能力决定
- **失败条件**：压力值 达到上限 时战斗失败
- **恢复方式**：特定卡牌、事件或遗物效果

#### 学术深度 (Academic Depth)
- **作用**：理论学家职业的特殊数值
- **获取方式**：特定卡牌或事件获得
- **作用**：影响某些卡牌效果或解锁特殊能力

### 1.2 卡牌相关数值

#### 卡牌费用 (Cost)
- **类型**：整数值或特殊值'X'
- **支付资源**：消耗能量点数
- **特殊规则**：
  - 'X'费用：根据当前能量值决定实际消耗
  - 某些特质可修改费用

#### 伤害数值 (Damage)
- **基础伤害**：卡牌固有的伤害值
- **加成来源**：
  - 严谨度特质 (Strength)
  - 临时加成效果
  - 职业被动能力

#### 特质堆叠 (Trait Stacks)
- **机制**：某些效果可以堆叠多次
- **显示方式**：在卡牌/角色上显示层数
- **衰减规则**：通常在回合结束时减少

## 2. 战斗流程详解

### 2.1 战斗初始化阶段

1. **环境设置**
   - 加载战斗场景背景
   - 初始化玩家和敌人位置
   - 设置初始UI元素

2. **数值初始化**
   - 玩家生命值：根据抗压能力设置
   - 玩家能量：3/3（第一回合）
   - 玩家自信：0
   - 敌人状态：根据敌人模板初始化

3. **卡牌准备**
   - 洗牌初始化牌库
   - 抽取初始手牌（通常5张）
   - 设置弃牌堆和消耗堆为空

### 2.2 回合开始阶段

**触发时机**：每个新回合开始时

**执行顺序**：
1. **回合数增加**
2. **能量补充**
   ```
   当前能量 = 3  # 固定补充至3点
   ```
3. **触发回合开始事件**
   - 职业被动技能生效
   - 特质"回合开始"效果触发
   - 遗物效果激活

4. **抽牌阶段**
   - 默认抽5张牌
   - 受抽牌相关效果影响
   - 触发抽牌事件（特质响应）

### 2.3 玩家行动阶段

**阶段特点**：玩家可以自由行动直到结束回合

#### 行动选项：
1. **打出卡牌**
   - 检查能量是否足够
   - 检查卡牌特殊条件（如理论洁癖只能在全是攻击牌时使用）
   - 选择目标（如果需要）
   - 执行卡牌效果
   - 将卡牌移至弃牌堆

2. **查看牌库状态**
   - 查看抽牌堆、弃牌堆、消耗堆
   - 预览下一张牌

3. **查看角色状态**
   - 当前生命值、能量、自信
   - 激活的特质和状态效果
   - 遗物效果

#### 特殊机制：
- **卡牌互动**：某些卡牌可以指定其他手牌为目标
- **连锁效果**：卡牌效果可能触发其他卡牌或特质效果
- **能量管理**：玩家需要合理分配能量使用

### 2.4 敌人行动阶段

**触发时机**：玩家点击"结束回合"按钮

**执行流程**：
1. **敌人选择行动**
   - 根据当前状态选择最优技能
   - 考虑能量消耗和效果价值
   - 设置行动意图显示

2. **执行技能效果**
   - 消耗能量
   - 应用技能效果到目标
   - 触发相关事件

3. **回合结束处理**
   - 抽取一张新技能牌
   - 增加能量上限
   - 补充能量至上限
   - 重新选择下一回合行动

### 2.5 回合结束阶段

**玩家回合结束时的处理**：
1. **状态效果更新**
   - 减少临时状态效果持续时间
   - 应用持续性伤害/治疗
   - 触发"回合结束"特质效果

2. **自信清零**
   - 所有临时自信点数归零

3. **检查战斗结束条件**
   - 玩家生命值 ≤ 0 → 战斗失败
   - 所有敌人生命值 ≤ 0 → 战斗胜利
   - 达到回合数限制 → 根据条件判断胜负

## 3. 卡牌系统详解

### 3.1 卡牌类型

#### 攻击牌 (Attack)
- **主要效果**：造成伤害
- **特殊机制**：
  - 理论洁癖：要求手牌全是攻击牌才能使用
  - 随机过程：对随机目标造成多次伤害
  - 高阶微积分：造成大量伤害并施加减益

#### 技能牌 (Skill)
- **主要效果**：防御、治疗、状态效果
- **特殊机制**：
  - 基本假设：获得自信防御伤害
  - 论文发表：造成等同于自信值的伤害

#### 能力牌 (Power)
- **主要效果**：永久性增益
- **特殊机制**：
  - 持续多回合生效
  - 通常消耗后进入消耗堆

### 3.2 卡牌效果类型

#### 伤害效果 (Damage)
```json
{
  "type": "damage",
  "value": 8,
  "target": "selected_enemy"
}
```

#### 自信效果 (Confidence)
```json
{
  "type": "confidence",
  "value": 10,
  "target": "player"
}
```

#### 状态效果 (Status Effects)
- **增益 (Buff)**：提升属性或能力
- **减益 (Debuff)**：降低属性或造成持续伤害
- **特殊效果**：独特机制，如抽牌限制、伤害加成等

#### 复合效果 (Complex Effects)
```json
{
  "type": "damage_and_confidence",
  "damage": 6,
  "confidence": 8,
  "target": "selected_enemy"
}
```

## 4. 特质系统 (Trait System)

### 4.1 特质类型

#### 数值修改特质
- **费用修改**：降低/提高卡牌费用
- **伤害加成**：提升造成的伤害
- **防御增强**：提升获得的自信

#### 事件响应特质
- **回合开始**：回合开始时触发效果
- **回合结束**：回合结束时触发效果
- **卡牌使用**：使用特定类型卡牌时触发
- **受到伤害**：受到伤害时触发

#### 特殊机制特质
- **堆叠策略**：ADD（相加）、MULTIPLY（相乘）、OVERRIDE（覆盖）
- **触发条件**：满足特定条件时激活

### 4.2 特质示例

#### 费用减免特质
- **触发条件**：使用技能牌
- **效果**：费用减少1点
- **堆叠策略**：相加

#### 伤害加成特质
- **触发条件**：造成伤害时
- **效果**：伤害增加25%
- **堆叠策略**：相乘

## 5. 敌人设计

### 5.1 敌人属性

#### 基础属性
- **生命值**：敌人的血量上限
- **最大能量**：敌人每回合可用的能量上限
- **技能列表**：敌人可使用的技能池

#### 特殊机制
- **自信系统**：临时防御值，优先抵挡伤害
- **技能牌组**：动态抽牌和技能选择
- **意图显示**：预览下一回合行动

### 5.2 敌人AI逻辑

#### 技能选择策略
1. **优先级排序**
   - 能量消耗最低的技能优先
   - 对玩家威胁最大的技能优先
   - 恢复类技能在低血量时优先

2. **意图更新**
   - 每回合结束重新评估
   - 根据玩家状态调整策略
   - 显示给玩家预览

#### 回合执行流程
```
选择技能 → 消耗能量 → 执行效果 → 抽新技能 → 增加能量上限 → 补充能量 → 重新选择技能
```

## 6. 战斗平衡设计

### 6.1 数值平衡原则

#### 卡牌强度曲线
- **1费卡牌**：基础效果，数值适中
- **2费卡牌**：中等强度，常用核心
- **3费以上**：高价值，强力效果

#### 回合递增平衡
- **前期**：低能量限制，鼓励使用基础卡牌
- **中期**：能量稳步增长，解锁中等强度卡牌
- **后期**：高能量上限，使用重磅卡牌

### 6.2 策略深度

#### 资源管理
- **能量分配**：合理分配有限能量
- **手牌规划**：预留关键卡牌
- **时机把握**：选择最佳使用时机

#### 风险收益
- **早期投资**：使用低费卡牌建立优势
- **中期积累**：保存资源应对后期
- **爆发输出**：在关键时刻使用高费卡牌

### 6.3 随机性控制

#### 可预测的随机
- **敌人意图**：预览敌人行动
- **牌库构筑**：玩家可控制卡牌组成
- **事件结果**：固定奖励池

#### 策略空间
- **多重选择**：每回合多种行动可能
- **连锁反应**：卡牌效果间的互动
- **长线规划**：考虑多回合的资源分配

## 7. UI/UX设计要点

### 7.1 信息展示

#### 核心数值显示
- **玩家状态栏**：生命值、能量、自信
- **敌人状态栏**：生命值、自信、意图
- **卡牌信息**：费用、效果、描述

#### 视觉反馈
- **能量消耗**：卡牌变灰表示无法使用
- **伤害计算**：预览伤害数值
- **效果触发**：动画和音效反馈

### 7.2 操作流程

#### 简化操作
- **拖拽打牌**：直观的卡牌操作
- **智能目标选择**：自动选择最优目标
- **快捷键支持**：键盘快捷操作

#### 引导机制
- **新手教程**：逐步介绍系统
- **提示系统**：操作提示和建议
- **视觉指引**：箭头和光效指引

## 8. 数据驱动设计

### 8.1 配置系统

#### 卡牌配置
```json
{
  "card_id": "theorist_strike",
  "name_key": "基础理论",
  "cost": 1,
  "type": "Attack",
  "effects": [
    {
      "type": "damage",
      "value": 6,
      "target": "selected_enemy"
    }
  ]
}
```

#### 敌人配置
```json
{
  "enemy_id": "thesis_advisor",
  "name": "论文导师",
  "max_health": 80,
  "skills": ["questioning", "criticism", "guidance"]
}
```

### 8.2 平衡调整

#### 数值调优
- **版本迭代**：根据玩家反馈调整数值
- **数据分析**：统计卡牌使用率和胜率
- **A/B测试**：对比不同数值方案

#### 内容扩展
- **新卡牌**：通过配置文件添加
- **新敌人**：模块化敌人设计
- **新特质**：插件式特质系统

## 9. 测试和验证

### 9.1 自动化测试

#### 单元测试
- **数值计算**：验证伤害、费用计算正确性
- **状态管理**：测试状态效果的正确应用
- **卡牌逻辑**：验证卡牌特殊条件和效果

#### 集成测试
- **完整回合**：测试完整的回合流程
- **战斗流程**：验证战斗初始化到结束的完整流程
- **边缘情况**：测试异常情况和边界条件

### 9.2 平衡性测试

#### 数据分析
- **卡牌使用率**：统计各卡牌的使用频率
- **胜率统计**：分析不同构筑的胜率
- **回合长度**：监控战斗时长分布

#### 玩家测试
- **可用性测试**：观察玩家操作流程
- **平衡性反馈**：收集数值平衡建议
- **乐趣测试**：评估游戏体验质量

## 10. 扩展规划

### 10.1 短期扩展

#### 新内容类型
- **更多卡牌**：扩展卡牌池
- **新敌人**：增加战斗多样性
- **新特质**：丰富策略深度

#### 机制优化
- **UI改进**：提升操作体验
- **数值平衡**：优化卡牌强度
- **教程完善**：降低学习成本

### 10.2 长期规划

#### 新游戏模式
- **挑战模式**：特殊规则的战斗
- **合作模式**：多人合作战斗
- **竞技模式**：玩家对战

#### 高级机制
- **卡组构筑**：自定义卡组
- **职业系统**：多职业选择
- **Roguelike元素**：随机事件和奖励

---

*本文档将随着游戏开发进度持续更新。如有问题或建议，请及时与主策划团队沟通。*
