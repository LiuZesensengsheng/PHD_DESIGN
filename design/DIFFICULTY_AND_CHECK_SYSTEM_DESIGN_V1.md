## 战役难度 & 检定加值系统设计 v1

> 本文整合甘特块长度/融合带来的战役难度、场景词缀系统，以及类似 DnD/CoC 的“检定 + 加值（优势）”机制，为后续数值实现与内容生产提供统一蓝图。
>
> 关联文档：  
> - `docs/design/GANTT_TRIS_MODEL_GDD.md`  
> - `docs/design/campaign/GANTT_FUSION_RULES.md`  
> - `docs/design/campaign/GANTT_TASKS_EVENTS.md`  
> - `docs/design/COMBAT_SYSTEM_DOCUMENT.md`  
> - `docs/design/IDEAL_SYSTEM_DESIGN_v8.0_FINAL.md`  

---

## 一、设计目标

- **统一口径**：把“甘特长度/融合”“场景词缀”“检定加值”统一到同一套难度框架中，避免各自为政。
- **强可读性**：玩家应能在战役层面大致读懂“这块有多危险”，失败时能复盘是**贪心/错判**而非“纯被系统阴”。
- **高风味度**：难度提升不只是一串 +20%，而是有明确“场景味道”和“读博体验”的差异。
- **易实现 & 易调参**：核心逻辑尽量保持线性、可枚举；复杂度更多交给内容池（词缀、敌人模板）而非规则本身。

---

## 二、甘特块长度 & 融合 → 难度档位

### 2.1 基本概念

- `length_i`：第 i 个参与融合的甘特块长度，范围 1–3（代表该块危险程度/持续时间）。  
- `blocks`：参与本次融合的任务块数量（不含 DDL 特殊块），范围 1–4（第 5 个通常为 DDL，由 DDL 规则接管）。  
- `total_length = Σ length_i`：融合后新块的总长度。  

为兼顾“这一坨有多长”和“这是几件事缝在一起的复合灾难”，定义一个**危险度分数**：

```text
danger_score = total_length + (blocks - 1)
```

> 直觉：  
> - `total_length` 代表这摊事“有多厚”；  
> - `(blocks - 1)` 代表这是“几件事堆在一起”的复合压力。

### 2.2 难度档位（D0–D3）

基于 `danger_score`，定义 4 档战役难度（不含 DDL 战）：  

- **D0 普通战（Normal）**  
  - 条件：`danger_score ≤ 3`  
  - 场景：1 个块、长度 1–3，或两个很小的块。  
  - 用途：主频体验，读作“正常工作日”。

- **D1 紧绷战（Tight）**  
  - 条件：`4 ≤ danger_score ≤ 5`  
  - 场景：2–3 个普通块，或 1 个长块 + 小块。  
  - 用途：提醒玩家“你最近有点贪了，但还不至于爆炸”。

- **D2 危险战（Dangerous）**  
  - 条件：`6 ≤ danger_score ≤ 7`  
  - 场景：3–4 个块，或总长度已经明显夸张。  
  - 对齐口径：**大约“3 次融合后应该变得很危险”的区间**。

- **D3 准 Boss 战（Pre-Boss）**  
  - 条件：`danger_score ≥ 8`（在 1–3 长度 + 1–4 块约束下，基本对应 4 个块都卷在一起的极端情况）。  
  - 场景：DDL 前最后一坨“连环车祸块”。  
  - 对齐口径：**不再只是普通战的放大版，而是小章节终极考验**。

> DDL 特殊规则：  
> - 第 5 个块大概率是 DDL；  
> - 任意块撞上 DDL 时，按 `GANTT_TRIS_MODEL_GDD.md` 与 `GANTT_FUSION_RULES.md` 中的 DDL 污染/强制结算逻辑处理；  
> - DDL 战不进入 D0–D3 这套分档，由专门 Boss/结算规则接管。

---

## 三、多乘区难度模型（“这场为什么这么难？”）

为便于设计与调参，将一场战斗的难度拆分为多个近似独立的“乘区”（Multipliers），每个乘区可以单独挂规则与内容：

```text
战斗强度 ≈ 敌人基础模板
         × 战役危险度档位（D0–D3）
         × 敌人本体强化乘区
         × 场景/环境乘区
         × 我方约束乘区
         × 心理 & 战后后果乘区
```

### 3.1 敌人基础模板（Baseline）

- 定义敌人的**基础 HP / 压力伤害 / 意图池 / 行为模式**。  
- 不携带任何“难度专用逻辑”，是可在多难度下复用的“素体”。

### 3.2 战役危险度档位乘区（D0–D3）

基于第 2 节的档位，为所有敌人统一应用简单数值倍率：

- **D0**：HP ×1.0，压力伤害 ×1.0  
- **D1**：HP ×1.10，压力伤害 ×1.05  
- **D2**：HP ×1.25，压力伤害 ×1.15  
- **D3**：HP ×1.40，压力伤害 ×1.25  

> 数值可调；本节重点是“不同档位在数值上确实有肉眼可见区别”，同时避免过度依赖词缀堆叠。

### 3.3 敌人本体强化乘区

- **本体词缀（Enemy Affix）**：写在敌人身上的被动，如：  
  - `[冲刺]：每 2 回合行动两次`  
  - `[复盘]：第一次被打死时以 30% HP 复活一次`
- **行为模式升级**：高难度版本解锁额外意图或血线阈值行为：  
  - 例如：D2/D3 才会进入“压迫循环/爆发循环”。

> 本体乘区主要用在：精英/少数普通怪的“高难版本”，不必在每一战都打开。

### 3.4 场景/环境乘区（Scene Affix）

- 绑定在甘特节点的 **主题/场景** 上，而非某个具体敌人：  
  - 例：  
    - LAB：`[安全检查周] 敌人每 2 回合获得 +2 力量`  
    - FINALS：`[最后一周] 战斗开始时，你前两回合抽牌 -1`
- 一场战斗可携带 0–N 个场景词缀，用于表达“这次实验室/DDL 特别倒霉的某个细节”。

### 3.5 我方约束乘区（Player Constraint）

- **我方削弱词缀**：直接对玩家下手：  
  - `本战手牌上限 -1`  
  - `本战每回合首次打出的牌费用 +1`  
  - `本战冲突牌每次额外 +1 张心魔`
- **资源经济限制**：  
  - 抽牌 / 能量 / 自信 / 压力回复的减益或上限变化。

### 3.6 心理 & 战后后果乘区

- **心理系统放大（Ideal/SAN 区）**：  
  - 本战“初心的考验”更偏向裂痕/破灭；  
  - 本战心魔上限从 6 提到 8，但战后奖励+1 档（高风险高回报）。
- **战后经济后果**：  
  - 奖励倍率、战后减压/回血量；  
  - 额外惩罚/奖励事件（如“评审意见/导师谈话”）。

---

## 四、难度档位 × 词缀槽位设计

仅靠“词缀数量”无法优雅地区分 4–5 个难度档，因此引入“轻/重词缀 + 数值档位”的组合。

### 4.1 词缀类型

- **轻型词缀（Minor Affix）**：  
  - 易读、影响中等，偏“风味 + 轻惩罚/轻加成”。  
  - 示例：  
    - `[今日有点乱]：战斗开始时，敌人获得 10 点自信护盾。`  
    - `[组会挤在一起]：本战第 1 回合，你的抽牌 -1。`

- **重型词缀（Major Affix）**：  
  - 显著改变打法，难度贡献高。  
  - 示例：  
    - `[安全检查周]（LAB）：敌人每 2 回合获得 +2 力量。`  
    - `[最后一周]（FINALS）：每回合你打出的第 1 张牌费用 +1。`

> 轻/重词缀均可以是“场景型”或“我方约束型”；本体强化更适合用作重型词缀的一部分。

### 4.2 难度档位与词缀槽位

建议口径：

- **D0 普通战**  
  - 数值：基线。  
  - 词缀槽：0（不挂场景/约束词缀）。  

- **D1 紧绷战**  
  - 数值：HP ×1.10，压力伤害 ×1.05。  
  - 词缀槽：**1 个轻型词缀**（优先用作场景词缀）。  

- **D2 危险战**  
  - 数值：HP ×1.25，压力伤害 ×1.15。  
  - 词缀槽：**1 个重型词缀 + 1 个轻型词缀**  
    - 一般推荐：1 场景重型 + 1 我方削弱轻型。  

- **D3 准 Boss 战**  
  - 数值：HP ×1.40，压力伤害 ×1.25。  
  - 词缀槽：**2 个重型词缀（或 1 重 + 1 轻 + 1“开场态”）**  
    - 需要人工把控组合，作为“名场面”设计，而非完全随机。

> 随机生成时，基于 D 档位先确定“词缀预算”，再从对应主题的轻/重池中抽取，避免一场战斗出现 4–5 条玩家看不完的说明。

---

## 五、跑团式“检定 + 加值”系统

本节把 DnD/CoC 中“基础数值 + 目标难度 + 优势/劣势 + 骰子”的思想，映射到本游戏现有的理想/甘特/事件系统中。

### 5.1 检定点总览（v1 范围）

优先为已经具备“判定味道”的节点定义检定模型：

- **(1) SAN / 理想检定：压力 100 时的“初心的考验”**  
  - 已在 `IDEAL_SYSTEM_DESIGN_v8.0_FINAL.md` 中定义：利用 `window_count` / `lifetime_count` / `effective` 映射到美德/裂痕/破灭。  
  - 本文仅补充“加值/优势”的统一口径。

- **(2) 事件 & 组会选项检定**  
  - 部分高风险高收益选项（例如“硬刚导师”“冒险投高档期刊”）可挂上成功/失败判定。  

- **(3) 甘特危险战的“场景难度骰”**  
  - 在 D2/D3 档位内，为场景乘区丢一次小骰，决定是“偏简单/标准/偏困难版本”（±10% 或词缀数 ±1）。

> v1 建议只在上述三个大类使用“检定 + 加值”，避免过度泛化。

### 5.2 抽象模型：对齐 TRPG

借鉴 DnD/CoC，可抽象为：

```text
成功概率 ≈ 自身基础（牌组/特质/理想） 
        × 目标难度（场景/敌人给出的阈值）
        × 情境修正（场景词缀/我方约束）
        × 骰子运气（一次或“优势/劣势”双掷）
```

在本游戏中的具体对应：

- **自身基础**：  
  - 当前牌组强度（难以直接数值化，主要体现在“你选不选这个风险选项”）；  
  - 特质/理想/日志给出的“加值标签”（下节定义）。  
- **目标难度**：  
  - 由事件编剧或数值直接给出：普通 / 困难 / 极难；  
  - 或由 D 档位/场景等级反推。  
- **情境修正**：  
  - 当前场景词缀、我方约束等；  
  - 临时状态（如某次组会前的特殊事件）。  
- **骰子运气**：  
  - 简化为少量 D6/D10 检定，或“优势/劣势”重掷。

### 5.3 加值来源（谁来给我“优势”？）

为避免引入一整套“力量/敏捷/体质”，加值来源全部绑定到现有系统：

- **特质（Traits）**  
  - 如：`[实验室老油条]：在 LAB 场景检定中拥有优势。`  
- **理想（Ideals）**  
  - 如：`[厚积薄发]：在 SAN 检定时，effective 计算中 -1（一次或常驻）。`  
- **日志/创新点（Journals / Innovations）**  
  - 如：`[组会吐槽手册]：在组会事件中选择“硬刚选项”时，成功率 +1 档。`  
- **关键卡牌**  
  - 如：某张牌写明“本战下一次 SAN 检定拥有优势”或“本战下一次 Gantt 危险战词缀 -1”。

> 这些来源可以统一实现为一个 `CheckModifier` 接口，由各系统（特质/理想/日志/牌）在需要时注册。

### 5.4 加值类型（Modifier Types）

为保持可读性，避免“+7%”这类细碎数值，统一采用少量高语义的效果：

- **优势 / 劣势（Advantage / Disadvantage）**  
  - 对检定丢两次骰子，优势取优，劣势取劣。  
  - 适用：  
    - SAN 检定（例如仅在危险边缘时允许重掷一次）；  
    - 场景难度骰（例如某特质允许你在 LAB 危险战中重掷一次场景骰）。

- **阈值偏移（Threshold Shift）**  
  - 例如在 SAN 检定中：`effective -1`，使破灭更难触发。  
  - 在事件中：让“困难”选项按“普通”难度结算。

- **词缀预算调整（Affix Budget Adjustment）**  
  - 例如：  
    - 本战危险战的场景词缀数 -1；  
    - 或把一个重型词缀替换为轻型词缀。

> 所有加值类型都应在 UI 上用简短、自然语言呈现，例如：“你在实验室场景的检定上更有把握”“这次审判对你稍微宽容一些”。

---

## 六、落地与后续工作

### 6.1 实现层面建议

- 在战役路由层：  
  - 根据参与块 `length_i` 与 `blocks` 计算 `danger_score` → D 档位；  
  - 基于 D 档位决定：数值倍率 + 词缀预算；  
  - 再从对应主题的轻/重词缀池中抽取场景/约束词缀。

- 在战斗装配层：  
  - 按多乘区模型依次应用：基础模板 → D 档数值 → 敌人本体强化 → 场景词缀 → 我方约束 → 心理/战后后果。

- 在检定系统层：  
  - 为 SAN / 事件 / Gantt 危险战实现统一的 `CheckContext` + `CheckModifier` 接口，便于特质/理想/日志/牌注入加值。

### 6.2 内容与数值工作（后续）

- 为 LAB / FINALS（优先）各设计：  
  - 3–5 个轻型场景词缀；  
  - 2–3 个重型场景词缀；  
  - 若干我方约束型词缀。  
- 为部分特质/理想/日志补充“加值描述”，并标记对应的 `CheckType`。  
- 在内测中埋点：  
  - 不同 D 档位的出现频率、通关率、战斗时长；  
  - 不同词缀组合的退游率/好评率；  
  - 检定加值（优势/阈值偏移）实际触发频率与体验反馈。

> 本文为 v1 蓝图，重点是把“难度”和“加值”拆分为若干可控乘区与可读档位。后续如需变更结构性规则，应先在本文件更新口径，再同步至相关战役/理想/事件文档。


