## 论文线·气泡与强制剧情规范（MVP 草案）

本稿用于确定“消息气泡”与“强制剧情面板”的放置、优先级、触发来源与数据结构，供程序与美术落地。仅文档，不含实现。

### 1. 目标与原则
- 高密但不打扰：每回合都有“活性反馈”，不阻断主要操作。
- 分层分流：不同重要度的消息去不同位置，避免同屏拥挤。
- 数据驱动：气泡内容、权重、TTL、冷却、优先级均由外部配置决定。
- 可弃用：玩家可在设置中关闭或降频。

### 2. 展示层级与放置
- 全局泡（右上角“吃瓜频道”）
  - 用途：世界/八卦/成就/被引用提示/发表播报等“全局性消息”。
  - 行为：队列滚动展示（最多并发2条），自动淡入/淡出；点击打开“消息盒”查看历史。
- 轨道泡（每条任务线左端或时间轴起点）
  - 用途：与该轨道强相关的持续类信息（论文线：审稿进度、编辑分配、返修倒计时等）。
  - 行为：同一轨道同屏最多1条，叠加显示数量角标；点击切换最新一条。
- 块泡（锚定在具体任务块右上角或上边缘）
  - 用途：瞬时反馈，如开始/完成/即将DDL/融合成功/被PINNED阻止等。
  - 行为：0.8–1.5秒短显，优先级低于轨道泡。

备注：三层可并行存在，优先级从高到低为“强制面板（非泡） > 全局泡 ≈ 轨道泡 > 块泡”。

### 3. 频率与节流（全局护栏）
- 每回合上限：全局泡 ≤ 2、每轨道泡 ≤ 1、每块泡 ≤ 1；超出进入队列按优先级播放。
- 冷却与去重：同类事件在 30 秒（或 N 回合）内合并为“×N”形式。
- 玩家选项：关闭 / 降频 / 仅关键事件。

### 4. 文案与风味
- 长度建议：12–22 字；黑色幽默 + 轻度“废话文学”；必要时附小图标（🕒📎🔨📮）。
- 论文线等待期常见播报：已分配编辑、审稿人下载PDF、系统自动提醒、返修催促等（仅叙事，不改数值）。
- 结果日流程：先“预告泡”（轨道泡）→ 进入“审判剧场”（强制面板）→ “结果泡”（全局＋轨道各1条，防漏读）。

### 5. 强制剧情（Blocking Events）
- 定义：改变流程、需确认的里程碑事件（审判剧场、发表揭幕、主线分歧等）。
- 触发：置顶执行，遮罩背景，禁止交互；关闭后按分支继续（我们现已“演完再判”）。
- 分级：
  - A 级：DDL 审判、发表面板、关键分歧。
  - B 级：一次性引导（可跳过）。
  - 非强制：均用气泡处理。
- 关联气泡：强制事件前播“预告泡”，结束后播“结果泡”。

### 6. 触发来源（事件→气泡）
- 领域事件（建议标准化）：  
  - block_started / block_completed / block_about_to_deadline  
  - thesis_editor_assigned / reviewer_assigned / review_progress_tick  
  - thesis_verdict_announced / thesis_published / thesis_cited  
  - fusion_success / fusion_blocked_by_pinned / movement_clamped  
  - reward_obtained / currency_changed / item_received
- 生成器：事件 → Bubble 对象（含类别、优先级、TTL、文本、锚点 track_id / block_id）。

### 7. 数据结构（建议）
文件：`data/ui/bubbles_config.json`
```json
{
  "global": {
    "cooldown_sec": 30,
    "max_concurrent": 2
  },
  "categories": {
    "thesis_wait": {
      "priority": 60,
      "ttl_sec": 2.0,
      "placement": "track", 
      "weights": { "T0": 0.8, "T1": 1.0, "T2": 1.0, "T3": 0.8, "T4": 0.6 },
      "texts": ["编辑外出学习中（系统已自动提醒）。", "审稿人#2下载了PDF，正在寻找打印机。", "服务器说今天适合返修。"]
    },
    "thesis_result": {
      "priority": 90,
      "ttl_sec": 2.5,
      "placement": "global",
      "texts": ["最终决定：大修", "最终决定：小修", "最终决定：接收", "最终决定：拒绝"]
    },
    "fusion": {
      "priority": 40,
      "ttl_sec": 1.2,
      "placement": "block",
      "texts": ["融合成功", "被 #PINNED 阻止"]
    }
  }
}
```

字段说明：
- placement: "global" | "track" | "block"
- priority: 0–100，越大越先展示
- ttl_sec: 存活时间
- weights: 可选，按层级或时间段调节出现概率
- texts: 候选文案池

### 8. 校验与可配置
- 验证工具：复用 Data Validation Service，新增 `validate_bubbles_config`：
  - 必须字段（placement/priority/ttl_sec/texts）；
  - 文案去重、长度上限（建议 28 字）。
- 运行时选项：设置里支持关闭/降频；debug 面板显示当前队列与丢弃统计。

### 9. 论文线 MVP 默认配比
- 等待期：80% 轨道泡、20% 全局泡。
- 结果日：预告＝轨道泡；结果＝全局＋轨道各1条；同时进入强制“审判剧场”。
- 发表与被引：全局泡播报；论文轨道补一条“荣誉泡”。

### 10. 视觉与交互（占位）
- 动画：淡入 150ms、停留 ttl、淡出 150ms；鼠标悬停暂停计时。
- 交互：默认鼠标穿透；悬停时捕获滚轮切换同类消息。
- 样式：三层使用同一基底（美术统一），颜色/小图标区分类别。

### 11. 开放问题
- 是否允许“右上角消息盒”驻留查看与置顶收藏？
- 轨道泡的角标风格与交互（点击切换 vs 自动轮播）取舍？
- 与成就/日记系统的归档打通方式。

—— 以上为讨论版草案，欢迎在此文直接批注或勾选要/不要项。 


