# EEE 整合规则体系 v1.2.0

> **基于EEE_CONTRACT.json的正式化表达**  
> 整合了用户规则、长期记忆、Cursor规则的统一实践指南

## 🎯 核心使命

**解决AI助手上下文窗口有限的问题**，通过"契约式"/"宪法式"方法，将项目知识和开发规则"外部化"，降低AI认知负担，保证项目长期健康。

## 📊 成功指标

- **调试周期计数 (DCC)**: 基线目标 ≤ 10次
- **首次提交正确率**: 持续提升
- **AI上下文获取时间**: ≤ 3分钟 (通过ai-guide命令)

## 🔧 核心原则 (按优先级排序)

### Tier 1: 已验证实践 (立即执行)

#### 1. 语义化锚点 (零魔法值)
```json
{
  "name": "语义化锚点", 
  "status": "严格执行",
  "tools": ["custom_grep_scanner", "pylint"]
}
```
- **绝对禁止**: 硬编码字符串、数字、坐标、节点名、事件名
- **强制要求**: 所有常量定义在专用常量文件中
- **实践位置**: `constants/`, `scripts/script_constants/`
- **验证工具**: pylint魔法值检测

#### 2. 结构化契约 (强类型)
```json
{
  "name": "结构化契约",
  "status": "严格执行", 
  "tools": ["mypy", "typing.Protocol"]
}
```
- **绝对禁止**: 使用`Any`类型、泛型字典承载业务逻辑
- **强制要求**: typing.Protocol定义接口，完整类型注解
- **实践位置**: `*/protocols.py`文件
- **验证工具**: mypy静态检查

#### 3. 实时反馈 (质量门禁)  
```json
{
  "name": "实时反馈",
  "status": "严格执行",
  "tools": ["pytest", "mypy", "pylint"]
}
```
- **绝对禁止**: 跳过静态分析检查
- **强制要求**: 代码提交前通过所有质量检查
- **实践位置**: 通过`manage.py`工具链
- **验证工具**: 三重检查 (pytest + mypy + pylint)

### Tier 2: 部分实现 (持续完善)

#### 4. 情境化记忆 (Bug历史)
```json
{
  "name": "情境化记忆", 
  "status": "已实现",
  "implementation": "分布式地方病历"
}
```
- **当前实现**: `.bugdata`文件系统
- **工作原理**: `some_file.py` → `some_file.py.bugdata`
- **优势**: Bug历史与代码物理共存
- **注意事项**: 需要工具链支持，避免"孤儿数据"

#### 5. 知识破局 (三次原则)
```json
{
  "name": "知识破局",
  "status": "记忆原则",
  "trigger": "连续3次失败"
}
```
- **核心规则**: 同一问题连续3次失败 → 立即放弃 → 网络搜索
- **目标**: 避免无效路径，强制发散思考
- **应用场景**: 顽固技术难题，如工具链"幽灵Bug"

#### 6. 动态蓝图 (任务驱动)
```json
{
  "name": "动态蓝图",
  "status": "部分实现", 
  "current_tool": "manage.py任务系统"
}
```
- **当前实现**: TASK_*.md文件 + `manage.py list-tasks`
- **工作原理**: 结构化任务文档驱动开发
- **待完善**: 标准化JSON格式，状态机管理

### Tier 3: 理论探索 (长期目标)

#### 7. 动态自解释架构契约
```json
{
  "name": "架构契约",
  "status": "设计中",
  "current_base": "DDD + Cursor分层规则"
}
```
- **当前基础**: 航天级/工业级/实验室级分层标准
- **目标**: 机器可读的设计模式契约 (design_contract.json)
- **实现路径**: 基于DDD实践 → 工具链支持

#### 8. 分层意图契约
```json
{
  "name": "分层意图契约",
  "status": "理论探索",
  "format": "自然语言 → 对话草案 → 执行合同"
}
```
- **理念**: AI不能直接执行自然语言指令
- **流程**: Gherkin/Markdown草案 → 人类确认 → JSON执行合同
- **状态**: 高度理论化，需要具体工具支持

#### 9. 任务委派与成本优化
```json
{
  "name": "成本优化",
  "status": "理论探索", 
  "requirement": "工具性能数据库"
}
```
- **理念**: AI评估任务 → 选择最优工具
- **需求**: 工具评估机制，性能数据库
- **状态**: 需要大量基础设施支持

## 🏗️ 架构分层标准 (Cursor Rules)

### 🚀 航天级: robust_game_toolkit核心模块
- **零容忍政策**: 无Any类型，具体异常处理，依赖隔离
- **文档要求**: 完整docstring，充分测试覆盖
- **哲学**: "核心地基"质量决定项目可扩展高度

### 🏭 工业级: contexts目录
- **结构化开发**: DDD原则，清晰模块界限  
- **质量要求**: 静态分析通过，协议驱动接口
- **哲学**: 业务逻辑的可靠实现

### 🧪 实验室级: 其他模块
- **灵活开发**: 允许快速原型，迭代验证
- **基本要求**: 遵循零魔法值，基础类型安全
- **哲学**: 创新与质量的平衡

### ⚒️ 工具链级: scripts/manage.py
- **集中化操作**: 所有开发操作的统一入口
- **自解释能力**: `ai-guide`命令提供实时指南
- **哲学**: 让"做正确的事"比"走捷径"更容易

## 🎯 执行优先级

1. **立即执行**: 继续强化Tier 1原则 (魔法值、类型安全、质量门禁)
2. **持续完善**: 标准化Tier 2实现 (Bug历史、任务驱动)
3. **长期研究**: 探索Tier 3理论 (架构契约、意图契约)

## 🔄 持续改进

- **DCC监控**: 每个新功能都要证明DCC ≤ 10
- **工具效果评估**: 新工具必须证明其价值
- **简化优于复杂**: 遵循"系统性谦逊"原则

---

*本文档基于EEE_CONTRACT.json v1.2.0，整合了用户规则、长期记忆和Cursor规则体系* 